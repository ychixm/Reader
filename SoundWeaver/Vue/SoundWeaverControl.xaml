<UserControl
    x:Class="SoundWeaver.SoundWeaverControl"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:audio="clr-namespace:SoundWeaver.Audio"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:SoundWeaver"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:models="clr-namespace:SoundWeaver.Models"
    xmlns:vue="clr-namespace:SoundWeaver.Vue"
    d:DesignHeight="650"
    d:DesignWidth="850"
    mc:Ignorable="d">

    <UserControl.Resources>
        <audio:OnlyContinuousVisibility x:Key="OnlyContinuousVisibility" />
        <audio:OnlyInstantVisibility x:Key="OnlyInstantVisibility" />
    </UserControl.Resources>

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>


        <GroupBox Grid.Row="0" Margin="5">
            <StackPanel>
                <StackPanel HorizontalAlignment="Left" Orientation="Horizontal">
                    <Button
                        Grid.Column="0"
                        Margin="5,5,5,5"
                        Command="{Binding ShowAddChannelDialogCommand}"
                        Content="Ajouter un salon" />
                    <ComboBox
                        Grid.Column="1"
                        Width="250"
                        Margin="5,5,5,5"
                        HorizontalAlignment="Left"
                        DisplayMemberPath="ChannelName"
                        ItemsSource="{Binding ChannelSettings}"
                        SelectedItem="{Binding SelectedChannelSetting, Mode=TwoWay}" />
                </StackPanel>
                <StackPanel HorizontalAlignment="Left" Orientation="Horizontal">
                    <Button
                        Width="120"
                        Margin="5,5,5,5"
                        Command="{Binding ConnectBotCommand}"
                        Content="Connect Bot" />
                    <Button
                        Width="120"
                        Margin="5,5,5,5"
                        Command="{Binding DisconnectBotCommand}"
                        Content="Disconnect Bot" />
                </StackPanel>
            </StackPanel>
        </GroupBox>

        <!--  Playlists Scroller  -->
        <StackPanel
            Grid.Row="1"
            Margin="5"
            Orientation="Vertical">
            <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Disabled">
                <StackPanel Orientation="Horizontal">
                    <ItemsControl ItemsSource="{Binding Playlists}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel Orientation="Horizontal" />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <vue:PlaylistElement Margin="5,0" />
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                    <!--  Le bouton est ici, dans le flux horizontal  -->
                    <Button
                        Margin="10,0,0,0"
                        Padding="16,0"
                        Command="{Binding AddPlaylistCommand}"
                        Content="&#xFF0B; Nouvelle playlist" />
                </StackPanel>
            </ScrollViewer>
        </StackPanel>
        <GroupBox
            Grid.Row="2"
            Margin="0,10,0,0"
            Header="Effets sonores et ambiances">
            <StackPanel>
                <Button
                    Margin="0,0,0,5"
                    Command="{Binding AddSfxCommand}"
                    Content="Ajouter un SFX" />
                <ItemsControl ItemsSource="{Binding SfxElements}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <UniformGrid Columns="2" />
                            <!--  ou change Columns selon la place  -->
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border
                                Margin="6"
                                Padding="8"
                                BorderBrush="Gray"
                                BorderThickness="1"
                                CornerRadius="8">
                                <StackPanel>
                                    <TextBlock FontWeight="Bold" Text="{Binding DisplayName}" />
                                    <TextBlock
                                        FontSize="10"
                                        Foreground="Gray"
                                        Text="{Binding FilePath}"
                                        TextTrimming="CharacterEllipsis" />
                                    <StackPanel
                                        Margin="0,7,0,0"
                                        VerticalAlignment="Center"
                                        Orientation="Horizontal">
                                        <TextBlock
                                            Margin="0,0,5,0"
                                            VerticalAlignment="Center"
                                            Text="Volume" />
                                        <Slider
                                            Width="90"
                                            VerticalAlignment="Center"
                                            Maximum="1"
                                            Minimum="0"
                                            Value="{Binding Volume, Mode=TwoWay}" />
                                    </StackPanel>

                                    <!--  Controles selon le type  -->
                                    <StackPanel Margin="0,7,0,0" Orientation="Horizontal">
                                        <!--  CONTINUOUS  -->
                                        <StackPanel Orientation="Horizontal" Visibility="{Binding Type, Converter={StaticResource OnlyContinuousVisibility}}">
                                            <Button
                                                Width="34"
                                                Command="{Binding DataContext.PlaySfxCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                CommandParameter="{Binding}"
                                                Content="&#x25B6;" />
                                            <Button
                                                Width="34"
                                                Command="{Binding DataContext.PauseSfxCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                CommandParameter="{Binding}"
                                                Content="&#x23F8;" />
                                            <Button
                                                Width="34"
                                                Command="{Binding DataContext.StopSfxCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                CommandParameter="{Binding}"
                                                Content="&#x23F9;" />

                                            <Slider
                                                Width="90"
                                                Margin="8,0,0,0"
                                                VerticalAlignment="Center"
                                                Maximum="{Binding Duration.TotalSeconds}"
                                                Minimum="0"
                                                Value="{Binding PositionSeconds, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                            <TextBlock
                                                Margin="6,0,0,0"
                                                FontSize="10"
                                                Text="{Binding Position, StringFormat={}{0:mm\\:ss}}" />
                                        </StackPanel>
                                        <!--  INSTANT  -->
                                        <StackPanel Orientation="Horizontal" Visibility="{Binding Type, Converter={StaticResource OnlyInstantVisibility}}">
                                            <Button
                                                Width="34"
                                                Command="{Binding DataContext.PlaySfxCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                CommandParameter="{Binding}"
                                                Content="&#x25B6;" />
                                            <Button
                                                Width="34"
                                                Command="{Binding DataContext.StopSfxCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                CommandParameter="{Binding}"
                                                Content="&#x23F9;" />
                                        </StackPanel>
                                        <Button
                                            Width="34"
                                            Margin="8,0,0,0"
                                            Command="{Binding DataContext.RemoveSfxCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                            CommandParameter="{Binding}"
                                            Content="&#x1F5D1;" />
                                        <Button Command="{Binding DataContext.ToggleMuteSfxCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" CommandParameter="{Binding}">
                                            <TextBlock>
                                                <TextBlock.Style>
                                                    <Style TargetType="TextBlock">
                                                        <Setter Property="Text" Value="&#x1F507;" />
                                                        <Setter Property="ToolTip" Value="Mute" />
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding State}" Value="Muted">
                                                                <Setter Property="Text" Value="&#x1F50A;" />
                                                                <Setter Property="ToolTip" Value="Unmute" />
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </TextBlock.Style>
                                            </TextBlock>
                                        </Button>
                                    </StackPanel>
                                </StackPanel>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </StackPanel>
        </GroupBox>


        <!--  Global Controls  -->
        <StackPanel Grid.Row="3" Margin="5">
            <Border BorderBrush="White" BorderThickness="1">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <Button
                        Grid.Column="0"
                        HorizontalAlignment="Left"
                        Command="{Binding StopAllAudioCommand}"
                        Content="Stop All Audio" />

                    <StatusBar Grid.Column="1" Margin="5,0,0,0">
                        <StatusBarItem>
                            <TextBlock Text="{Binding StatusMessage}" />
                        </StatusBarItem>
                    </StatusBar>
                </Grid>
            </Border>
        </StackPanel>


    </Grid>
</UserControl>
